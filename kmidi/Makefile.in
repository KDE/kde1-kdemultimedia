#
#                           KMidi Makefile
#
#  Copyright 1997 Bernd Johannes Wuebben, wuebben@math.cornell.edu
#
#  $Id$
#

DEBUGFLAGS = -Wall -g
VERSION = 0.2i

CXXFLAGS= @CXXFLAGS@ @all_includes@ -DHAVE_CONFIG_H -I..
CFLAGS= @CFLAGS@ -DDEFAULT_PATH=\"$(TIMID_DIR)\"  @EXTRAINCS@
LDFLAGS	= @LDFLAGS@ @all_libraries@ -lkfm -lkdecore -lkdeui -lqt -lXext -lX11 @EXTRALIBS@ @LIBALIB@ @LIBAUDIO@ @LIBMME@ @LIBSOCKET@
CXX     = @CXX@
MOC   	= @MOC@

############# INSTALL #################

INSTALL = @INSTALL@ -m 0755
INSTALL_DATA = @INSTALL@ -m 0644
INSTALL_DIR = @INSTALL@ -d -m 0755
INSTALL_DIR_PRIVATE = @INSTALL@ -d -m 0700

prefix       = @prefix@
exec_prefix  = @exec_prefix@
install_root = @install_root@
kde_libraries = @kde_libraries@
qt_libraries = @qt_libraries@
x_libraries = @x_libraries@
top_builddir = ..
LIBTOOL = @LIBTOOL@
KDE_RPATH = @KDE_RPATH@
BINDIR       = @kde_bindir@
PICSDIR      = @kde_datadir@/kmidi/pics
ICONDIR      = @kde_icondir@
DOCSDIR      = @kde_htmldir@/en/kmidi
DOCSDIRDE      = @kde_htmldir@/de/kmidi
APPSDIR      = @kde_appsdir@/Multimedia
# Where to install the patches, config files, and MIDI files.
# If you change this, it's a good idea to recompile the binary,
# or you'll need to invoke timidity with the -L option.
TIMID_DIR = @kde_datadir@/kmidi/config



########### File Formats ###########

DEFS =
.SUFFIXES: .cpp

.cpp.o:
	$(CXX) $(DEFS) -c $(CXXFLAGS) $<
.c.o:
	$(CC) $(DEFS) -c $(CFLAGS) $<

%.moc: %.h
	$(MOC) $< -o $@

########## Files #####################

SOURCES =kmidi.cpp  playlist.cpp bwlednum.cpp configdlg.cpp log.cpp\
	timidity.c common.c readmidi.c playmidi.c resample.c mix.c instrum.c \
	tables.c controls.c output.c filter.c wave_a.c raw_a.c dumb_c.c \
	sndfont.c readsbk.c linux_a.c ctl.c dec_a.c sun_a.c hpux_a.c

HEADERS =kmidi.h  playlist.h bwlednum.h configdlg.h\
	config.h common.h readmidi.h playmidi.h resample.h mix.h instrum.h \
	tables.h controls.h output.h filter.h log.h

OBJECTS =kmidi.o  playlist.o bwlednum.o configdlg.o log.o\
	timidity.o common.o readmidi.o playmidi.o resample.o mix.o instrum.o \
	tables.o controls.o output.o filter.o wave_a.o raw_a.o dumb_c.o \
	sndfont.o readsbk.o linux_a.o ctl.o  sun_a.o hpux_a.o dec_a.o

SRCMETA =	kmidi.moc  playlist.moc bwlednum.moc configdlg.moc log.moc
TARGET	=	kmidi


######### build rules ################

all: $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kmidi/$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(TARGET): $(SRCMETA) $(OBJECTS)
	$(LIBTOOL) --mode=link $(CXX) $(OBJECTS) -o $(TARGET) $(LDFLAGS) $(KDE_RPATH)

depend:
	@makedepend $(SOURCES) 2> /dev/null

showfiles:
	@echo $(SOURCES) $(HEADERS) Makefile

clean:
	rm -f *.o *.bak *~ *% #*
	rm -f $(SRCMETA) $(TARGET)

distclean: clean
	rm -f Makefile

install: all
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	(cd docs && $(MAKE) install)
	$(INSTALL_DIR) $(APPSDIR)
	$(INSTALL_DATA) KMidi.kdelnk $(APPSDIR)
	$(INSTALL_DIR) $(PICSDIR)
	$(INSTALL_DIR) $(ICONDIR)
	$(INSTALL_DATA) kmidi.xpm $(ICONDIR)
	$(INSTALL_DATA) kmidilogo.xpm $(PICSDIR)
	$(INSTALL_DIR) $(TIMID_DIR)
	$(INSTALL_DIR) $(TIMID_DIR)/patch
	if [ ! -e $(TIMID_DIR)/patch/acpiano.pat ]; then $(INSTALL_DATA) patch/acpiano.pat $(TIMID_DIR)/patch ; fi
	if [ ! -e $(TIMID_DIR)/patch/nylongt2.pat ]; then $(INSTALL_DATA) patch/nylongt2.pat $(TIMID_DIR)/patch ;fi
	(cd config && $(MAKE) install)

	@echo ""
	@echo "Important:"
	@echo "=========="	
	@echo "Midis:"
	@echo "I have included a couple of nice midis in the kmidi/midis directory."
	@echo ""
	@echo "Sound Patches:"
	@echo "Only a simple  piano and guitar sound patch come with this distribution."
	@echo "This  means that you can only play guitar or piano midis such as the"
	@echo "included cavatina.mid, malaguena.mid until you get yourself a full set" 
	@echo "of general midi patches. Read the html docs for more info on how to obtain "
	@echo "a full set of General Midi (GM)  patches."
	@echo ""
	@echo "ONCE YOU HAVE A FULL SET YOU WON'T BELIEVE YOUR EARS -- PROMISE!"
	@echo ""
	@echo "Have fun with kmidi -- Bernd Wuebben <wuebben@kde.org>"



uninstall:
	rm -f $(BINDIR)/$(TARGET)
	rm -f $(DOCSDIR)/kmidi.html
	rm -f $(DOCSDIR)/kmidi.gif
	rm -f $(ICONDIR)/kmidi.xpm
	rm -f $(PICSDIR)/kmidilogo.xpm
	rm -f $(APPSDIR)/KMidi.kdelnk
	(cd docs && $(MAKE) uninstall)
	rm -f $(TIMID_DIR)/patch/acpiano.pat
	rm -f $(TIMID_DIR)/patch/nylongt2.pat
	(cd config && $(MAKE) uninstall)

# DO NOT DELETE THIS LINE -- make depend depends on it.

