# This is a sample Makefile.in 

# @CXXFLAGS@     : is set to -g -Wall (when debuging) or -O2 -Wall (when not)
# @all_includes@ : is set to all needed include paths for QT, KDE and X11
# -I.. 	         : needed for config.h
CXXFLAGS= @CXXFLAGS@ @all_includes@ -DHAVE_CONFIG_H -I..

# @LDFLAGS@    : is set to -s (when not debuging) for stripping
# @all_libra.@ : is set to all needed libraries paths for QT, KDE and X11
# you need also @LIBSOCKET@, if you link with -lkfm
LDFLAGS	= @LDFLAGS@ @all_libraries@ -lkdecore -lkdeui -lqt -lXext -lX11 

# both are clear, I think
CXX     = @CXX@
MOC   	= @MOC@

############# INSTALL #################

install = @INSTALL@
INSTALL = $(install) -m 0755
INSTALL_DATA = $(install) -m 0644
INSTALL_DIR = $(install) -d -m 0755
INSTALL_DIR_PRIVATE = $(install) -d -m 0700

prefix = @prefix@
install_root = @install_root@
exec_prefix = @exec_prefix@
BINDIR = @kde_bindir@
DATADIR = @kde_datadir@/kmid

########### File Formats ###########

.SUFFIXES: .cpp

.cpp.o:
	$(CXX) -c $(CXXFLAGS) $<

%.moc: %.h
	$(MOC) $< -o $@

########## Files #####################

OBJECTS =	kmidframe.o kmidclient.o kdisptext.o kslidertime.o midicfgdlg.o main.o
PLAYEROBJECTS = midiout.o player.o track.o midimapper.o midfile.o dattypes.o midistat.o deviceman.o synthout.o
SRCMETA =	kmidframe.moc kmidclient.moc kdisptext.moc kslidertime.moc midicfgdlg.moc 
TARGET	=	kmid 

######### build rules ################

all: Makefile $(TARGET)

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kmid/$@ CONFIG_HEADERS= $(SHELL) ./config.status

$(TARGET): $(SRCMETA) $(OBJECTS) $(PLAYEROBJECTS)
	$(CXX) $(OBJECTS) $(PLAYEROBJECTS) -o $(TARGET) $(LDFLAGS)

$(PLAYEROBJECTS):
	(cd player && make all_copy && cd ..)

#install:
#	./install.sh	

install: $(TARGET)
	$(INSTALL_DIR) $(DATADIR)
	$(INSTALL) $(TARGET) $(BINDIR)
	$(INSTALL_DIR) @kde_appsdir@/Multimedia
	$(INSTALL_DATA) kmid.kdelnk @kde_appsdir@/Multimedia
	$(INSTALL_DIR) @kde_mimedir@/audio
	$(INSTALL_DATA) x-karaoke.kdelnk @kde_mimedir@/audio
	$(INSTALL_DIR) @kde_htmldir@/en/kmid
	$(INSTALL_DATA) kmid.html @kde_htmldir@/en/kmid
	(cd toolbarxpm && $(MAKE) install)
	$(INSTALL_DIR) @kde_icondir@
	$(INSTALL_DATA) kmid.xpm @kde_icondir@
	$(INSTALL_DIR) $(DATADIR)/maps
	(cd maps && $(MAKE) install)
	(cd examples && $(MAKE) install)


uninstall:
	rm -f $(BINDIR)/$(TARGET)
	(cd maps && $(MAKE) uninstall)
	(cd examples && $(MAKE) uninstall)
	(cd toolbarxpm && $(MAKE) uninstall)
	-rm -f @kde_icondir@/kmid.xpm
	-rm -f @kde_mimedir@/audio/x-karaoke.kdelnk
	-rm -f @kde_appsdir@/Multimedia/kmid.kdelnk
	rm -f @kde_htmldir@/en/kmid/kmid.html

clean:
	(cd player && make clean && cd ..)
	(cd toolbarxpm && $(MAKE) uninstall)
	(cd maps && $(MAKE) uninstall)
	(cd examples && $(MAKE) uninstall)
	rm -f *.o *.bak *~ *% #*
	rm -f $(SRCMETA) $(TARGET)

distclean: clean
	rm -f Makefile


# DO NOT DELETE THIS LINE -- make depend depends on it.
