# $Id$

prefix  = @prefix@

kde_libraries = @kde_libraries@
qt_libraries = @qt_libraries@
x_libraries = @x_libraries@
top_builddir = ..
exec_prefix = @exec_prefix@
LIBTOOL = @LIBTOOL@
KDE_RPATH = @KDE_RPATH@
topdir = @topdir@
install_root = @install_root@

SHELL = /bin/sh
MIMEDIR = @kde_mimedir@/text/
BINDIR  = @kde_bindir@
ICONDIR  = @kde_icondir@
MINIDIR  = @kde_minidir@
PICSDIR  = @kde_datadir@/kscd/pics/
APPSDIR = @kde_appsdir@/Multimedia
CDDBDIR = @kde_datadir@/kscd/cddb/
install = @INSTALL@
INSTALL = $(install) -m 0755
INSTALL_DATA = $(install) -m 0644
INSTALL_DIR = $(install) -d -m 0755   
INSTALL_CDDB_DIR = $(install) -d -m 0777   

###################################################################

CXXFLAGS=	@CXXFLAGS@  -DHAVE_CONFIG_H -I..
LDFLAGS	=	@LDFLAGS@ @all_libraries@ @LIBCDROM@ @LIBCDAUDIO@ @LIBSOCKET@ @LIBFPE@ -lkdecore -lkdeui -lkfm -lqt  -lX11 -lXext
INCDIR	=	@all_includes@
CXX	=	@CXX@
MOC	=	@MOC@
CC 	=	@CC@
CFLAGS	=	

#We need those for Irix. Don't know yet how to handle this with autoconf
#IRIXLIBS = -lcdaudio -lmediad -lds

####### Files

HEADER = kscd.h struct.h bwlednum.h ledlamp.h inexact.h CDDialog.h CDDialogData.h\
	CDDBSetup.h CDDBSetupData.h mgconfdlg.h

SOURCES	= kscd.cpp configdlg.cpp cddb.cpp ledlamp.cpp CDDialog.cpp CDDialogData.cpp \
	CDDBSetup.cpp CDDBSetupData.cpp docking.cpp \
	inexact.cpp cdinfo.c mgconfdlg.cpp \
	plat_sun.c plat_hpux.c plat_linux.c plat_news.c \
	plat_bsd386.c plat_ultrix.c cdrom.c scsi.c drv_toshiba.c drv_sony.c \
	plat_svr4.c plat_freebsd.c plat_osf1.c plat_irix.c bwlednum.cpp

SOURCES2=plat_sun_audio.c plat_sun_cdda.c cddaslave.c  


SOURCES3=kscdmagic/bitmap.cpp  kscdmagic/core.cpp kscdmagic/main.cpp \
	kscdmagic/sound.cpp kscdmagic/xlibwrap.cpp kscdmagic/xlib.c

OBJECTS3=kscdmagic/bitmap.o  kscdmagic/core.o kscdmagic/main.o \
	kscdmagic/sound.o kscdmagic/xlibwrap.o kscdmagic/xlib.o

OBJECTS	= kscd.o configdlg.o  ledlamp.o inexact.o cddb.o cdinfo.o\
	CDDialog.o CDDialogData.o CDDBSetup.o CDDBSetupData.o docking.o\
	plat_sun.o plat_hpux.o plat_linux.o plat_news.o mgconfdlg.o\
	plat_bsd386.o plat_ultrix.o cdrom.o scsi.o drv_toshiba.o drv_sony.o\
	plat_svr4.o plat_freebsd.o plat_osf1.o plat_irix.o bwlednum.o

OBJECTS2=plat_sun_audio.o plat_sun_cdda.o cddaslave.o 

SRCMETA	= kscd.moc bwlednum.moc configdlg.moc cddb.moc ledlamp.moc inexact.moc\
	CDDialog.moc CDDialogData.moc CDDBSetup.moc CDDBSetupData.moc\
	docking.moc mgconfdlg.moc

TARGET1 = kscd
TARGET2 = cddaslave
TARGET3 = kscdmagic

####### Implicit rules

.SUFFIXES: .cpp

.cpp.o:
	$(CXX)  -c $(CXXFLAGS) $(DEFS) $(INCDIR) $<
.c.o:
	$(CC)  -c $(CFLAGS) $(DEFS) $(INCDIR) $<

####### Build rules

all: $(TARGET1) $(TARGET2) 

Makefile: Makefile.in
	cd .. && CONFIG_FILES=kscd/$@ CONFIG_HEADERS= $(SHELL) ./config.status


config.h: kscd-script 
	sh kscd-script

kscd: config.h $(SOURCES) $(SRCMETA) $(OBJECTS) $(HEADER)
	(cd kscdmagic && $(MAKE) all )
	$(LIBTOOL) --mode=link $(CXX) $(OBJECTS) -o $(TARGET1) $(LDFLAGS) $(KDE_RPATH)

$(TARGET2): $(SOURCES2)  $(OBJECTS2) $(HEADER)
	$(LIBTOOL) --mode=link $(CXX) $(OBJECTS2) -o $(TARGET2) $(LDFLAGS) $(KDE_RPATH)



depend:
	@makedepend -I$(INCDIR) $(SOURCES) 2> /dev/null
clean:
	(cd docs && $(MAKE) clean)
	(cd kscdmagic && $(MAKE) clean)
	-rm -f *.o *.bak *~ *% #*
	-rm -f config.h
	-rm -f $(SRCMETA) $(TARGET1) $(TARGET2)

distclean: clean
	rm -f Makefile

install: all
	(cd docs && $(MAKE) install)
	(cd kscdmagic && $(MAKE) install)
	strip kscd
	$(INSTALL_DIR) $(BINDIR)
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/rock
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/blues
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/classical
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/jazz
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/newage
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/soundtrack
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/reggae
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/folk
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/country
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/misc
	$(INSTALL_CDDB_DIR) $(CDDBDIR)/data
	$(INSTALL) $(TARGET1) $(BINDIR)
	$(INSTALL) $(TARGET2) $(BINDIR)
	$(INSTALL_DIR) $(ICONDIR)
	$(INSTALL_DATA) kscd.xpm $(ICONDIR)
	$(INSTALL_DATA) bitmaps/cd.xpm $(ICONDIR)
	$(INSTALL_DIR) $(MINIDIR)
	$(INSTALL_DATA) mini-kscd.xpm $(MINIDIR)/kscd.xpm
	$(INSTALL_DIR) $(PICSDIR)
	$(INSTALL_DATA) kscdlogo.xpm $(PICSDIR)
	$(INSTALL_DATA) bitmaps/cdsmall.xpm $(PICSDIR)
	$(INSTALL_DIR) $(MIMEDIR)
	$(INSTALL_DATA) xmcd.kdelnk $(MIMEDIR)/xmcd.kdelnk
	$(INSTALL_DIR) $(APPSDIR)
	$(INSTALL_DATA) kscd.kdelnk $(APPSDIR)/kscd.kdelnk

uninstall:
	rm -f $(BINDIR)/$(TARGET1)
	rm -f $(BINDIR)/$(TARGET2)
	(cd docs && $(MAKE) uninstall)
	rm -f $(APPSDIR)/kscd.kdelnk
	rm -f $(PICSDIR)/kscdlogo.xpm
	rm -f $(ICONDIR)/kscd.xpm
	rm -f $(MINIDIR)/kscd.xpm
	rm -f $(ICONDIR)/cd.xpm
	rm -f $(MIMEDIR)/xmcd.kdelnk

####### Explicit dependencies


####### Meta objects

kscd.moc: kscd.h
	$(MOC) kscd.h -o kscd.moc

bwlednum.moc: bwlednum.h
	$(MOC) bwlednum.h -o bwlednum.moc

configdlg.moc: configdlg.h
	$(MOC) configdlg.h -o configdlg.moc

cddb.moc: cddb.h
	$(MOC) cddb.h -o cddb.moc

ledlamp.moc: ledlamp.h
	$(MOC) ledlamp.h -o ledlamp.moc

inexact.moc: inexact.h
	$(MOC) inexact.h -o inexact.moc

CDDialog.moc: CDDialog.h
	$(MOC) CDDialog.h -o CDDialog.moc

CDDBSetup.moc: CDDBSetup.h
	$(MOC) CDDBSetup.h -o CDDBSetup.moc

CDDialogData.moc: CDDialogData.h
	$(MOC) CDDialogData.h -o CDDialogData.moc

CDDBSetupData.moc: CDDBSetupData.h
	$(MOC) CDDBSetupData.h -o CDDBSetupData.moc

docking.moc: docking.h
	$(MOC) docking.h -o docking.moc

mgconfdlg.moc: mgconfdlg.h
	$(MOC) mgconfdlg.h -o mgconfdlg.moc









